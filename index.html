<!DOCTYPE html>
<html lang="en">

<head>

<meta charset="UTF-8">

<meta name="viewport"
content="
width=device-width,
height=device-height,
initial-scale=1.0,
maximum-scale=1.0,
minimum-scale=1.0,
user-scalable=no,
viewport-fit=cover
">

<meta name="theme-color" content="#000000">

<meta name="mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

<meta name="renderer" content="webkit">
<meta name="force-rendering" content="webkit">

<meta http-equiv="X-UA-Compatible" content="IE=edge">

<meta name="color-scheme" content="dark">

<title>Kuromi Engine</title>

<link rel="preconnect" href="https://jspm.dev" crossorigin>
<link rel="dns-prefetch" href="https://jspm.dev">

<link rel="modulepreload" href="./src/main.js">
<link rel="modulepreload" href="./src/core/Engine.js">
<link rel="modulepreload" href="./src/renderer/Renderer.js">
<link rel="modulepreload" href="./src/scene/SceneManager.js">
<link rel="modulepreload" href="./src/camera/CameraSystem.js">
<link rel="modulepreload" href="./src/systems/PerformanceMonitor.js">
<link rel="modulepreload" href="./src/systems/PerformanceScaler.js">

<link rel="stylesheet" href="styles.css">

<style>

:root{
color-scheme:dark;
}

html,body{
margin:0;
padding:0;
width:100%;
height:100%;
overflow:hidden;
background:#000;
touch-action:none;
overscroll-behavior:none;
-webkit-font-smoothing:antialiased;
-moz-osx-font-smoothing:grayscale;
}

#kuromi-engine-canvas{
position:fixed;
top:0;
left:0;
width:100%;
height:100%;
display:block;
outline:none;
contain:strict;
}

#engine-loader{
position:fixed;
top:0;
left:0;
width:100%;
height:100%;
display:flex;
align-items:center;
justify-content:center;
background:#000;
color:#fff;
font-family:sans-serif;
font-size:12px;
letter-spacing:2px;
z-index:9999;
opacity:1;
transition:opacity 0.6s ease;
pointer-events:none;
}

#engine-loader.hidden{
opacity:0;
}

</style>

</head>

<body>

<canvas
id="kuromi-engine-canvas"
tabindex="-1"
></canvas>

<div id="engine-loader">
INITIALIZING KUROMI ENGINE
</div>

<script type="module">

import EngineBootstrap from './src/main.js'

const loader=document.getElementById('engine-loader')

let bootStarted=false

function hideLoader(){

if(!loader)return

loader.classList.add('hidden')

setTimeout(()=>{
loader.remove()
},700)

}

async function safeBoot(){

if(bootStarted)return

bootStarted=true

try{

await EngineBootstrap.boot()

hideLoader()

}catch(e){

console.error('[KUROMI ENGINE BOOT FAILURE]',e)

if(loader){

loader.textContent='ENGINE FAILED TO START'

}

}

}

function bootWhenVisible(){

if(document.visibilityState==='visible'){

safeBoot()

return

}

const onVisible=()=>{

document.removeEventListener(
'visibilitychange',
onVisible
)

safeBoot()

}

document.addEventListener(
'visibilitychange',
onVisible,
{once:true}
)

}

if(document.readyState==='complete'||
document.readyState==='interactive'){

bootWhenVisible()

}else{

document.addEventListener(
'DOMContentLoaded',
bootWhenVisible,
{once:true}
)

}

window.addEventListener(
'pagehide',
()=>{},
{passive:true}
)

window.addEventListener(
'beforeunload',
()=>{},
{passive:true}
)

</script>

</body>

</html>
